<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¢é˜…ä¸“ä¸šç‰ˆ - VideoConvert</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .subscribe-container {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .plan-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .plan-name {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .plan-price {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }

        .plan-price span {
            font-size: 1.2rem;
            font-weight: 400;
        }

        .plan-features {
            list-style: none;
            margin-top: 1.5rem;
            text-align: left;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .plan-features li {
            padding: 0.5rem 0;
            display: flex;
            align-items: center;
        }

        .plan-features li:before {
            content: "âœ“";
            margin-right: 0.8rem;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .payment-section {
            padding: 2rem;
        }

        .section-title {
            font-size: 1.3rem;
            color: #333;
            margin-bottom: 1.5rem;
            font-weight: 600;
        }

        .payment-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .payment-method {
            padding: 1.5rem;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .payment-method:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .payment-method.selected {
            border-color: #667eea;
            background: #f8f9ff;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .payment-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .payment-name {
            font-weight: 600;
            color: #333;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #333;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .qr-code-section {
            display: none;
            text-align: center;
            padding: 2rem;
            background: #f8f9ff;
            border-radius: 12px;
            margin-bottom: 2rem;
        }

        .qr-code {
            width: 200px;
            height: 200px;
            background: white;
            margin: 1rem auto;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            border: 2px solid #e0e0e0;
        }

        .btn-subscribe {
            width: 100%;
            padding: 1.2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-subscribe:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .security-note {
            text-align: center;
            color: #999;
            font-size: 0.9rem;
            margin-top: 1rem;
        }

        .security-note:before {
            content: "ğŸ”’ ";
        }

        .back-link {
            text-align: center;
            margin-top: 2rem;
        }

        .back-link a {
            color: white;
            text-decoration: none;
            font-weight: 600;
        }

        .back-link a:hover {
            text-decoration: underline;
        }

        .success-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .success-content {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            text-align: center;
            max-width: 400px;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .success-icon {
            font-size: 5rem;
            margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
            .payment-methods {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>è®¢é˜…ä¸“ä¸šç‰ˆ</h1>
            <p>è§£é”æ‰€æœ‰é«˜çº§åŠŸèƒ½ï¼Œäº«å—æ— é™åˆ¶è½¬æ¢</p>
        </div>

        <div class="subscribe-container">
            <div class="plan-summary">
                <div class="plan-name" id="planName">ä¸“ä¸šç‰ˆ</div>
                <div class="plan-price" id="planPrice">Â¥29<span>/æœˆ</span></div>
                <ul class="plan-features" id="planFeatures">
                    <li>æ— é™æ¬¡è½¬æ¢</li>
                    <li>æœ€å¤§ 500MB æ–‡ä»¶</li>
                    <li>é«˜é€Ÿè½¬æ¢</li>
                    <li>æ‰¹é‡è½¬æ¢åŠŸèƒ½</li>
                    <li>ä¼˜å…ˆæŠ€æœ¯æ”¯æŒ</li>
                    <li>æ— å¹¿å‘Šä½“éªŒ</li>
                </ul>
            </div>

            <div class="payment-section">
                <div class="section-title">é€‰æ‹©æ”¯ä»˜æ–¹å¼</div>
                
                <div class="payment-methods">
                    <div class="payment-method" onclick="selectPayment('wechat')">
                        <div class="payment-icon">ğŸ’¬</div>
                        <div class="payment-name">å¾®ä¿¡æ”¯ä»˜</div>
                    </div>
                    <div class="payment-method" onclick="selectPayment('alipay')">
                        <div class="payment-icon">ğŸ’³</div>
                        <div class="payment-name">æ”¯ä»˜å®</div>
                    </div>
                    <div class="payment-method" onclick="selectPayment('card')">
                        <div class="payment-icon">ğŸ’°</div>
                        <div class="payment-name">ä¿¡ç”¨å¡</div>
                    </div>
                </div>

                <!-- äºŒç»´ç æ”¯ä»˜ -->
                <div class="qr-code-section" id="qrCodeSection">
                    <h3>è¯·ä½¿ç”¨<span id="paymentMethodName"></span>æ‰«ç æ”¯ä»˜</h3>
                    <div class="qr-code">ğŸ“±</div>
                    <p style="color: #666;">æ‰«æäºŒç»´ç å®Œæˆæ”¯ä»˜</p>
                    <p style="color: #999; font-size: 0.9rem; margin-top: 0.5rem;">æ”¯ä»˜é‡‘é¢: <strong id="paymentAmount"></strong></p>
                    <div id="paymentStatus" style="margin-top: 1rem; padding: 1rem; background: #fff3cd; border-radius: 8px; display: none;">
                        <p style="color: #856404; margin: 0; font-weight: 600;">â³ ç­‰å¾…æ”¯ä»˜ç¡®è®¤...</p>
                        <p style="color: #856404; margin: 0.5rem 0 0 0; font-size: 0.9rem;">è¯·åœ¨æ‰‹æœºä¸Šå®Œæˆæ”¯ä»˜</p>
                    </div>
                </div>

                <!-- ä¿¡ç”¨å¡è¡¨å• -->
                <div id="cardForm" style="display: none;">
                    <div class="form-group">
                        <label>å¡å·</label>
                        <input type="text" placeholder="1234 5678 9012 3456" maxlength="19">
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label>æœ‰æ•ˆæœŸ</label>
                            <input type="text" placeholder="MM/YY" maxlength="5">
                        </div>
                        <div class="form-group">
                            <label>CVV</label>
                            <input type="text" placeholder="123" maxlength="3">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>æŒå¡äººå§“å</label>
                        <input type="text" placeholder="ZHANG SAN">
                    </div>
                </div>

                <button class="btn-subscribe" id="subscribeBtn" onclick="handleSubscribe()">
                    ç«‹å³è®¢é˜…
                </button>

                <div class="security-note">
                    å®‰å…¨æ”¯ä»˜ Â· æ”¯æŒé€€æ¬¾ Â· è‡ªåŠ¨ç»­è´¹å¯éšæ—¶å–æ¶ˆ
                </div>
            </div>
        </div>

        <div class="back-link">
            <a href="index.html">â† è¿”å›é¦–é¡µ</a>
        </div>
    </div>

    <!-- æˆåŠŸæ¨¡æ€æ¡† -->
    <div class="success-modal" id="successModal">
        <div class="success-content">
            <div class="success-icon">ğŸ‰</div>
            <h2>è®¢é˜…æˆåŠŸï¼</h2>
            <p style="color: #666; margin: 1rem 0;">æ‚¨å·²æˆåŠŸè®¢é˜…ä¸“ä¸šç‰ˆ</p>
            <p style="color: #999; font-size: 0.9rem; margin-bottom: 2rem;">ç°åœ¨å¯ä»¥äº«å—æ— é™æ¬¡è½¬æ¢äº†</p>
            <button class="btn-subscribe" onclick="window.location.href='index.html'">
                å¼€å§‹ä½¿ç”¨
            </button>
        </div>
    </div>

    <script>
        let selectedPaymentMethod = null;
        let selectedPlan = 'pro';

        // ä» URL è·å–è®¡åˆ’
        const urlParams = new URLSearchParams(window.location.search);
        const plan = urlParams.get('plan') || 'pro';

        // è®¾ç½®è®¡åˆ’ä¿¡æ¯
        const plans = {
            pro: {
                name: 'ä¸“ä¸šç‰ˆ',
                price: 'Â¥29',
                period: '/æœˆ',
                features: [
                    'æ— é™æ¬¡è½¬æ¢',
                    'æœ€å¤§ 500MB æ–‡ä»¶',
                    'é«˜é€Ÿè½¬æ¢',
                    'æ‰¹é‡è½¬æ¢åŠŸèƒ½',
                    'ä¼˜å…ˆæŠ€æœ¯æ”¯æŒ',
                    'æ— å¹¿å‘Šä½“éªŒ'
                ]
            },
            enterprise: {
                name: 'ä¼ä¸šç‰ˆ',
                price: 'Â¥199',
                period: '/æœˆ',
                features: [
                    'æ— é™æ¬¡è½¬æ¢',
                    'æ— æ–‡ä»¶å¤§å°é™åˆ¶',
                    'æé€Ÿè½¬æ¢',
                    'API æ¥å£è®¿é—®',
                    'å›¢é˜Ÿåä½œåŠŸèƒ½',
                    'ä¸“å±å®¢æˆ·ç»ç†',
                    'SLA æœåŠ¡ä¿éšœ'
                ]
            }
        };

        function initPlan() {
            const planInfo = plans[plan];
            document.getElementById('planName').textContent = planInfo.name;
            document.getElementById('planPrice').innerHTML = `${planInfo.price}<span>${planInfo.period}</span>`;
            
            const featuresHTML = planInfo.features.map(f => `<li>${f}</li>`).join('');
            document.getElementById('planFeatures').innerHTML = featuresHTML;
        }

        function selectPayment(method) {
            selectedPaymentMethod = method;
            
            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.payment-method').forEach(el => {
                el.classList.remove('selected');
            });
            event.target.closest('.payment-method').classList.add('selected');

            // æ˜¾ç¤º/éšè—ç›¸åº”çš„æ”¯ä»˜ç•Œé¢
            const qrSection = document.getElementById('qrCodeSection');
            const cardForm = document.getElementById('cardForm');
            const paymentStatus = document.getElementById('paymentStatus');
            
            if (method === 'wechat' || method === 'alipay') {
                qrSection.style.display = 'block';
                cardForm.style.display = 'none';
                paymentStatus.style.display = 'none';
                document.getElementById('paymentMethodName').textContent = method === 'wechat' ? 'å¾®ä¿¡' : 'æ”¯ä»˜å®';
                document.getElementById('paymentAmount').textContent = plans[plan].price;
            } else if (method === 'card') {
                qrSection.style.display = 'none';
                cardForm.style.display = 'block';
            }
        }

        function handleSubscribe() {
            if (!selectedPaymentMethod) {
                alert('è¯·é€‰æ‹©æ”¯ä»˜æ–¹å¼');
                return;
            }

            // æ£€æŸ¥æ˜¯å¦ç™»å½•
            const user = JSON.parse(localStorage.getItem('videoconvert_user') || 'null');
            if (!user) {
                alert('è¯·å…ˆç™»å½•åå†è®¢é˜…');
                window.location.href = 'auth.html?redirect=subscribe&plan=' + plan;
                return;
            }

            // å¼€å§‹æ”¯ä»˜æµç¨‹
            const btn = document.getElementById('subscribeBtn');
            btn.textContent = 'æ­£åœ¨å¤„ç†æ”¯ä»˜...';
            btn.disabled = true;

            // æ¨¡æ‹Ÿæ”¯ä»˜éªŒè¯æµç¨‹
            if (selectedPaymentMethod === 'wechat' || selectedPaymentMethod === 'alipay') {
                // äºŒç»´ç æ”¯ä»˜ - æ¨¡æ‹Ÿç­‰å¾…æ‰«ç 
                simulateQRPayment(user);
            } else if (selectedPaymentMethod === 'card') {
                // ä¿¡ç”¨å¡æ”¯ä»˜ - éªŒè¯è¡¨å•
                if (validateCardForm()) {
                    simulateCardPayment(user);
                } else {
                    btn.textContent = 'ç«‹å³è®¢é˜…';
                    btn.disabled = false;
                }
            }
        }

        function validateCardForm() {
            const cardNumber = document.querySelector('input[placeholder="1234 5678 9012 3456"]').value;
            const expiry = document.querySelector('input[placeholder="MM/YY"]').value;
            const cvv = document.querySelector('input[placeholder="123"]').value;
            const name = document.querySelector('input[placeholder="ZHANG SAN"]').value;

            if (!cardNumber || !expiry || !cvv || !name) {
                alert('è¯·å¡«å†™å®Œæ•´çš„ä¿¡ç”¨å¡ä¿¡æ¯');
                return false;
            }

            if (cardNumber.replace(/\s/g, '').length < 13) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„å¡å·');
                return false;
            }

            if (!/^\d{2}\/\d{2}$/.test(expiry)) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æœ‰æ•ˆæœŸï¼ˆæ ¼å¼ï¼šMM/YYï¼‰');
                return false;
            }

            if (cvv.length !== 3) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ CVVï¼ˆ3ä½æ•°å­—ï¼‰');
                return false;
            }

            return true;
        }

        function simulateQRPayment(user) {
            const btn = document.getElementById('subscribeBtn');
            const paymentStatus = document.getElementById('paymentStatus');
            
            btn.textContent = 'ç­‰å¾…æ‰«ç æ”¯ä»˜...';
            paymentStatus.style.display = 'block';
            
            // æ˜¾ç¤ºå€’è®¡æ—¶
            let countdown = 120; // 2åˆ†é’Ÿ
            const countdownInterval = setInterval(() => {
                countdown--;
                btn.textContent = `ç­‰å¾…æ”¯ä»˜ (${countdown}s)`;
                
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    btn.textContent = 'æ”¯ä»˜è¶…æ—¶ï¼Œè¯·é‡è¯•';
                    btn.disabled = false;
                    paymentStatus.style.display = 'none';
                    alert('æ”¯ä»˜è¶…æ—¶ï¼Œè¯·é‡æ–°å°è¯•');
                }
            }, 1000);

            // æ¨¡æ‹Ÿæ”¯ä»˜æˆåŠŸï¼ˆ10ç§’åï¼‰
            setTimeout(() => {
                clearInterval(countdownInterval);
                
                // æ›´æ–°çŠ¶æ€ä¸ºéªŒè¯ä¸­
                paymentStatus.innerHTML = '<p style="color: #0066cc; margin: 0; font-weight: 600;">ğŸ” æ­£åœ¨éªŒè¯æ”¯ä»˜...</p>';
                btn.textContent = 'éªŒè¯æ”¯ä»˜ä¸­...';
                
                // éªŒè¯æ”¯ä»˜ç»“æœï¼ˆ2ç§’åï¼‰
                setTimeout(() => {
                    const paymentSuccess = confirm('ã€æ¼”ç¤ºæ¨¡å¼ã€‘æ”¯ä»˜éªŒè¯ï¼š\n\nç‚¹å‡»"ç¡®å®š"æ¨¡æ‹Ÿæ”¯ä»˜æˆåŠŸ\nç‚¹å‡»"å–æ¶ˆ"æ¨¡æ‹Ÿæ”¯ä»˜å¤±è´¥');
                    
                    if (paymentSuccess) {
                        paymentStatus.innerHTML = '<p style="color: #27ae60; margin: 0; font-weight: 600;">âœ“ æ”¯ä»˜éªŒè¯æˆåŠŸ</p>';
                        setTimeout(() => {
                            processSuccessfulPayment(user);
                        }, 1000);
                    } else {
                        btn.textContent = 'æ”¯ä»˜å¤±è´¥ï¼Œè¯·é‡è¯•';
                        btn.disabled = false;
                        paymentStatus.innerHTML = '<p style="color: #e74c3c; margin: 0; font-weight: 600;">âœ— æ”¯ä»˜å¤±è´¥</p>';
                        setTimeout(() => {
                            paymentStatus.style.display = 'none';
                        }, 3000);
                        alert('æ”¯ä»˜å¤±è´¥ï¼šæœªæ£€æµ‹åˆ°æ”¯ä»˜è®°å½•ï¼Œè¯·é‡æ–°å°è¯•');
                    }
                }, 2000);
            }, 10000);
        }

        function simulateCardPayment(user) {
            const btn = document.getElementById('subscribeBtn');
            btn.textContent = 'æ­£åœ¨éªŒè¯æ”¯ä»˜ä¿¡æ¯...';
            
            // ç¬¬ä¸€æ­¥ï¼šéªŒè¯å¡ä¿¡æ¯ï¼ˆ2ç§’ï¼‰
            setTimeout(() => {
                btn.textContent = 'æ­£åœ¨å¤„ç†æ”¯ä»˜...';
                
                // ç¬¬äºŒæ­¥ï¼šå¤„ç†æ”¯ä»˜ï¼ˆ2ç§’ï¼‰
                setTimeout(() => {
                    btn.textContent = 'æ­£åœ¨éªŒè¯æ”¯ä»˜ç»“æœ...';
                    
                    // ç¬¬ä¸‰æ­¥ï¼šéªŒè¯æ”¯ä»˜ç»“æœï¼ˆ1ç§’ï¼‰
                    setTimeout(() => {
                        // æ¨¡æ‹Ÿæ”¯ä»˜éªŒè¯ï¼ˆæ¼”ç¤ºæ¨¡å¼ï¼‰
                        const paymentSuccess = confirm('ã€æ¼”ç¤ºæ¨¡å¼ã€‘æ”¯ä»˜éªŒè¯ï¼š\n\nç‚¹å‡»"ç¡®å®š"æ¨¡æ‹Ÿæ”¯ä»˜æˆåŠŸ\nç‚¹å‡»"å–æ¶ˆ"æ¨¡æ‹Ÿæ”¯ä»˜å¤±è´¥');
                        
                        if (paymentSuccess) {
                            btn.textContent = 'æ”¯ä»˜æˆåŠŸï¼';
                            setTimeout(() => {
                                processSuccessfulPayment(user);
                            }, 500);
                        } else {
                            btn.textContent = 'æ”¯ä»˜å¤±è´¥ï¼Œè¯·é‡è¯•';
                            btn.disabled = false;
                            
                            // éšæœºé”™è¯¯æ¶ˆæ¯
                            const errors = [
                                'é“¶è¡Œæ‹’ç»äº†æ­¤æ¬¡äº¤æ˜“ï¼Œè¯·æ£€æŸ¥å¡ä¿¡æ¯',
                                'ä½™é¢ä¸è¶³ï¼Œè¯·æ›´æ¢æ”¯ä»˜æ–¹å¼',
                                'å¡ç‰‡å·²è¿‡æœŸï¼Œè¯·ä½¿ç”¨å…¶ä»–å¡ç‰‡',
                                'æ”¯ä»˜éªŒè¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•'
                            ];
                            const errorMsg = errors[Math.floor(Math.random() * errors.length)];
                            alert('æ”¯ä»˜å¤±è´¥ï¼š' + errorMsg);
                        }
                    }, 1000);
                }, 2000);
            }, 2000);
        }

        function processSuccessfulPayment(user) {
            // ç”Ÿæˆè®¢å•å·
            const orderId = 'VC' + Date.now() + Math.random().toString(36).substr(2, 9).toUpperCase();
            
            // æ›´æ–°ç”¨æˆ·è®¢é˜…çŠ¶æ€
            user.plan = plan;
            user.subscribeTime = new Date().toISOString();
            user.subscribeExpire = new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString();
            user.orderId = orderId;
            user.paymentMethod = selectedPaymentMethod;
            user.paymentAmount = plans[plan].price;
            
            localStorage.setItem('videoconvert_user', JSON.stringify(user));

            // é‡ç½®ä½¿ç”¨æ¬¡æ•°
            localStorage.setItem('videoconvert_usage', '0');

            // è®°å½•æ”¯ä»˜æˆåŠŸ
            console.log('æ”¯ä»˜æˆåŠŸ:', {
                orderId: orderId,
                plan: plan,
                amount: plans[plan].price,
                method: selectedPaymentMethod,
                time: new Date().toISOString()
            });

            // æ˜¾ç¤ºæˆåŠŸæ¨¡æ€æ¡†
            document.getElementById('successModal').style.display = 'flex';
        }

        // åˆå§‹åŒ–
        initPlan();
    </script>
</body>
</html>
