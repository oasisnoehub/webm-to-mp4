# 故障排查指南

## 问题已修复

我已经修复了以下问题：

### 1. 文件类型验证过于严格
**问题**: 服务器只接受 MIME 类型为 `video/webm` 的文件，但某些系统可能无法正确识别 WebM 文件的 MIME 类型。

**解决方案**: 现在同时检查 MIME 类型和文件扩展名（.webm）。

### 2. 缺少详细的错误信息
**问题**: 转换失败时没有提供足够的调试信息。

**解决方案**: 
- 添加了控制台日志记录
- 改进了错误消息
- 添加了 FFmpeg 未安装的特定错误提示

### 3. 点击事件冲突
**问题**: 上传区域的点击事件可能与按钮冲突。

**解决方案**: 添加了事件传播控制。

## 必须安装 FFmpeg

**重要**: 这个应用需要 FFmpeg 才能工作。

### macOS 安装:
```bash
brew install ffmpeg
```

### 验证安装:
```bash
ffmpeg -version
```

## 测试步骤

1. **确保 FFmpeg 已安装**
   ```bash
   ffmpeg -version
   ```

2. **启动服务器**
   ```bash
   npm start
   ```

3. **打开浏览器**
   访问 `http://localhost:3000`

4. **准备测试文件**
   - 你需要一个真实的 WebM 文件来测试
   - 可以从网上下载示例 WebM 文件
   - 或使用 FFmpeg 创建一个测试文件：
   ```bash
   ffmpeg -f lavfi -i testsrc=duration=5:size=320x240:rate=30 -pix_fmt yuv420p test.webm
   ```

5. **测试上传**
   - 拖放 WebM 文件到上传区域，或点击选择文件
   - 点击"开始转换"按钮
   - 等待转换完成
   - 点击"下载 MP4 文件"

## 调试技巧

### 查看浏览器控制台
打开浏览器开发者工具（F12），查看 Console 标签页的日志信息。

### 查看服务器日志
服务器终端会显示详细的处理日志：
- 文件上传信息
- 转换进度
- 错误详情

### 常见错误

**错误**: "FFmpeg 未安装或无法运行"
**解决**: 安装 FFmpeg: `brew install ffmpeg`

**错误**: "只支持 WebM 格式文件"
**解决**: 确保文件扩展名是 .webm

**错误**: "文件大小超过 100MB 限制"
**解决**: 使用较小的文件或修改 server.js 中的限制

**错误**: "网络错误"
**解决**: 确保服务器正在运行在 http://localhost:3000

## 当前状态

✅ 服务器已启动并运行在 http://localhost:3000
✅ 代码已修复并改进
⚠️ 需要安装 FFmpeg 才能进行视频转换

## 下一步

1. 安装 FFmpeg（如果还没安装）
2. 准备一个 WebM 测试文件
3. 在浏览器中测试完整流程
4. 如果遇到问题，查看浏览器控制台和服务器日志
