<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è°ƒè¯•ä¿¡æ¯</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
            line-height: 1.6;
        }
        .section {
            background: #252526;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            border-left: 4px solid #007acc;
        }
        h2 {
            color: #4ec9b0;
            margin-top: 0;
        }
        .success { color: #4ec9b0; }
        .error { color: #f48771; }
        .warning { color: #dcdcaa; }
        .info { color: #569cd6; }
        pre {
            background: #1e1e1e;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        button {
            background: #0e639c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1177bb;
        }
    </style>
</head>
<body>
    <h1>ğŸ” ç³»ç»Ÿè¯Šæ–­ä¿¡æ¯</h1>
    
    <div class="section">
        <h2>æµè§ˆå™¨ä¿¡æ¯</h2>
        <div id="browserInfo"></div>
    </div>
    
    <div class="section">
        <h2>åŠŸèƒ½æ”¯æŒæ£€æµ‹</h2>
        <div id="featureSupport"></div>
    </div>
    
    <div class="section">
        <h2>ç½‘ç»œè¿æ¥æµ‹è¯•</h2>
        <button onclick="testCDN()">æµ‹è¯• CDN è¿æ¥</button>
        <div id="networkTest"></div>
    </div>
    
    <div class="section">
        <h2>FFmpeg åº“æµ‹è¯•</h2>
        <button onclick="testFFmpegLibrary()">æµ‹è¯• FFmpeg åº“</button>
        <div id="ffmpegTest"></div>
    </div>

    <script>
        // æµè§ˆå™¨ä¿¡æ¯
        const browserInfo = document.getElementById('browserInfo');
        browserInfo.innerHTML = `
            <pre>
ç”¨æˆ·ä»£ç†: ${navigator.userAgent}
å¹³å°: ${navigator.platform}
è¯­è¨€: ${navigator.language}
åœ¨çº¿çŠ¶æ€: ${navigator.onLine ? 'âœ“ åœ¨çº¿' : 'âœ— ç¦»çº¿'}
Cookie å¯ç”¨: ${navigator.cookieEnabled ? 'âœ“ æ˜¯' : 'âœ— å¦'}
            </pre>
        `;

        // åŠŸèƒ½æ”¯æŒæ£€æµ‹
        const featureSupport = document.getElementById('featureSupport');
        const features = {
            'WebAssembly': typeof WebAssembly !== 'undefined',
            'SharedArrayBuffer': typeof SharedArrayBuffer !== 'undefined',
            'Worker': typeof Worker !== 'undefined',
            'Blob': typeof Blob !== 'undefined',
            'FileReader': typeof FileReader !== 'undefined',
            'fetch API': typeof fetch !== 'undefined',
            'Promise': typeof Promise !== 'undefined',
            'async/await': (async () => {})().constructor.name === 'Promise'
        };

        let featuresHTML = '<pre>';
        for (const [feature, supported] of Object.entries(features)) {
            const status = supported ? '<span class="success">âœ“ æ”¯æŒ</span>' : '<span class="error">âœ— ä¸æ”¯æŒ</span>';
            featuresHTML += `${feature.padEnd(20)}: ${status}\n`;
        }
        featuresHTML += '</pre>';
        featureSupport.innerHTML = featuresHTML;

        // æ£€æŸ¥å…³é”®é—®é¢˜
        if (!features['SharedArrayBuffer']) {
            featureSupport.innerHTML += '<p class="error">âš ï¸ è­¦å‘Š: SharedArrayBuffer ä¸å¯ç”¨ï¼è¿™æ˜¯ FFmpeg.wasm å¿…éœ€çš„åŠŸèƒ½ã€‚</p>';
            featureSupport.innerHTML += '<p class="warning">å¯èƒ½åŸå› ï¼š</p>';
            featureSupport.innerHTML += '<ul><li>æµè§ˆå™¨ç‰ˆæœ¬å¤ªæ—§</li><li>CORS å¤´éƒ¨æœªæ­£ç¡®è®¾ç½®</li><li>ä¸å®‰å…¨çš„ä¸Šä¸‹æ–‡ï¼ˆé HTTPSï¼‰</li></ul>';
        }

        // æµ‹è¯• CDN è¿æ¥
        async function testCDN() {
            const networkTest = document.getElementById('networkTest');
            networkTest.innerHTML = '<p class="info">æ­£åœ¨æµ‹è¯•...</p>';
            
            const cdns = [
                'https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js',
                'https://unpkg.com/@ffmpeg/core@0.11.0/dist/ffmpeg-core.js',
                'https://unpkg.com/@ffmpeg/core@0.11.0/dist/ffmpeg-core.wasm'
            ];
            
            let results = '<pre>';
            for (const url of cdns) {
                try {
                    const start = Date.now();
                    const response = await fetch(url, { method: 'HEAD' });
                    const time = Date.now() - start;
                    const status = response.ok ? 
                        `<span class="success">âœ“ å¯è®¿é—® (${time}ms)</span>` : 
                        `<span class="error">âœ— å¤±è´¥ (${response.status})</span>`;
                    results += `${url}\n${status}\n\n`;
                } catch (error) {
                    results += `${url}\n<span class="error">âœ— é”™è¯¯: ${error.message}</span>\n\n`;
                }
            }
            results += '</pre>';
            networkTest.innerHTML = results;
        }

        // æµ‹è¯• FFmpeg åº“
        async function testFFmpegLibrary() {
            const ffmpegTest = document.getElementById('ffmpegTest');
            ffmpegTest.innerHTML = '<p class="info">æ­£åœ¨åŠ è½½ FFmpeg åº“...</p>';
            
            try {
                // åŠ¨æ€åŠ è½½ FFmpeg åº“
                const script = document.createElement('script');
                script.src = 'https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js';
                
                script.onload = () => {
                    let result = '<pre>';
                    result += '<span class="success">âœ“ FFmpeg åº“åŠ è½½æˆåŠŸ</span>\n\n';
                    
                    if (typeof FFmpeg !== 'undefined') {
                        result += '<span class="success">âœ“ FFmpeg å¯¹è±¡å­˜åœ¨</span>\n';
                        result += `å¯ç”¨æ–¹æ³•: ${Object.keys(FFmpeg).join(', ')}\n`;
                        
                        if (typeof FFmpeg.createFFmpeg === 'function') {
                            result += '<span class="success">âœ“ createFFmpeg å‡½æ•°å¯ç”¨</span>\n';
                        } else {
                            result += '<span class="error">âœ— createFFmpeg å‡½æ•°ä¸å­˜åœ¨</span>\n';
                        }
                        
                        if (typeof FFmpeg.fetchFile === 'function') {
                            result += '<span class="success">âœ“ fetchFile å‡½æ•°å¯ç”¨</span>\n';
                        } else {
                            result += '<span class="error">âœ— fetchFile å‡½æ•°ä¸å­˜åœ¨</span>\n';
                        }
                    } else {
                        result += '<span class="error">âœ— FFmpeg å¯¹è±¡ä¸å­˜åœ¨</span>\n';
                    }
                    
                    result += '</pre>';
                    ffmpegTest.innerHTML = result;
                };
                
                script.onerror = (error) => {
                    ffmpegTest.innerHTML = `<p class="error">âœ— åŠ è½½å¤±è´¥: ${error}</p>`;
                };
                
                document.head.appendChild(script);
                
            } catch (error) {
                ffmpegTest.innerHTML = `<p class="error">âœ— é”™è¯¯: ${error.message}</p>`;
            }
        }

        // æ£€æŸ¥ CORS å¤´éƒ¨
        fetch(window.location.href)
            .then(response => {
                const headers = {
                    'Cross-Origin-Opener-Policy': response.headers.get('Cross-Origin-Opener-Policy'),
                    'Cross-Origin-Embedder-Policy': response.headers.get('Cross-Origin-Embedder-Policy')
                };
                
                const section = document.createElement('div');
                section.className = 'section';
                section.innerHTML = '<h2>CORS å¤´éƒ¨æ£€æŸ¥</h2><pre>' + 
                    JSON.stringify(headers, null, 2) + '</pre>';
                
                if (headers['Cross-Origin-Opener-Policy'] === 'same-origin' && 
                    headers['Cross-Origin-Embedder-Policy'] === 'require-corp') {
                    section.innerHTML += '<p class="success">âœ“ CORS å¤´éƒ¨é…ç½®æ­£ç¡®</p>';
                } else {
                    section.innerHTML += '<p class="error">âœ— CORS å¤´éƒ¨é…ç½®ä¸æ­£ç¡®ï¼ŒSharedArrayBuffer å¯èƒ½ä¸å¯ç”¨</p>';
                }
                
                document.body.appendChild(section);
            });
    </script>
</body>
</html>
